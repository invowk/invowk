---
sidebar_position: 2
---

import Snippet from '@site/src/components/Snippet';

# Runtime Native

O runtime **native** executa comandos usando o shell padrão do seu sistema. É a opção mais direta e a que você usará com mais frequência durante o desenvolvimento.

## Como Funciona

Quando você executa um comando com o runtime native, o Invowk:

1. Detecta o shell padrão do seu sistema
2. Cria um arquivo de script temporário
3. Executa-o através do shell
4. Transmite a saída de volta para seu terminal

## Detecção de Shell

O Invowk detecta automaticamente o melhor shell disponível:

### Linux/macOS

1. Usa a variável de ambiente `$SHELL` se definida
2. Usa `bash` como fallback se disponível
3. Usa `sh` como último recurso

### Windows

1. Tenta `pwsh` (PowerShell Core)
2. Usa `powershell` (Windows PowerShell) como fallback
3. Usa `cmd.exe` como último recurso

## Uso Básico

<Snippet id="runtime-modes/native-basic" />

```bash
invowk cmd myproject build
```

## Sobrescrevendo o Shell Padrão

Você pode sobrescrever o shell no nível do invkfile:

```cue
group: "myproject"
default_shell: "/bin/bash"  // Forçar bash

commands: [...]
```

Isso é útil quando:
- Você precisa de recursos específicos do bash
- Seu script depende de um shell específico
- Você quer comportamento consistente entre máquinas da equipe

## Scripts Específicos por Shell

### Bash/Zsh

```cue
{
    name: "build"
    implementations: [{
        script: """
            #!/bin/bash
            set -euo pipefail  # Modo estrito do Bash
            
            # Recursos específicos do Bash
            declare -A config=(
                ["env"]="production"
                ["debug"]="false"
            )
            
            echo "Building for ${config[env]}..."
            """
        target: {
            runtimes: [{name: "native"}]
            platforms: [{name: "linux"}, {name: "macos"}]
        }
    }]
}
```

### PowerShell

```cue
{
    name: "build"
    implementations: [{
        script: """
            $ErrorActionPreference = "Stop"
            
            Write-Host "Building..." -ForegroundColor Green
            dotnet build --configuration Release
            Write-Host "Done!" -ForegroundColor Green
            """
        target: {
            runtimes: [{name: "native"}]
            platforms: [{name: "windows"}]
        }
    }]
}
```

### cmd.exe (Windows Batch)

```cue
{
    name: "build"
    implementations: [{
        script: """
            @echo off
            echo Building...
            msbuild /p:Configuration=Release
            echo Done!
            """
        target: {
            runtimes: [{name: "native"}]
            platforms: [{name: "windows"}]
        }
    }]
}
```

## Usando Interpretadores

O runtime native suporta interpretadores não-shell como Python, Ruby ou Node.js.

### Auto-Detecção pelo Shebang

```cue
{
    name: "analyze"
    implementations: [{
        script: """
            #!/usr/bin/env python3
            import sys
            import json
            
            print(f"Python {sys.version}")
            data = {"status": "ok", "items": [1, 2, 3]}
            print(json.dumps(data, indent=2))
            """
        target: {
            runtimes: [{name: "native"}]
        }
    }]
}
```

### Interpretador Explícito

```cue
{
    name: "analyze"
    implementations: [{
        script: """
            import sys
            print(f"Hello from Python {sys.version_info.major}!")
            """
        target: {
            runtimes: [{
                name: "native"
                interpreter: "python3"  // Interpretador explícito
            }]
        }
    }]
}
```

### Interpretador com Argumentos

```cue
{
    name: "script"
    implementations: [{
        script: """
            print("Unbuffered output!")
            """
        target: {
            runtimes: [{
                name: "native"
                interpreter: "python3 -u"  // Com argumentos
            }]
        }
    }]
}
```

## Variáveis de Ambiente

O runtime native tem acesso completo ao seu ambiente:

```cue
{
    name: "deploy"
    env: {
        vars: {
            DEPLOY_ENV: "production"
        }
    }
    implementations: [{
        script: """
            echo "Home: $HOME"
            echo "User: $USER"
            echo "Deploy to: $DEPLOY_ENV"
            """
        target: {
            runtimes: [{name: "native"}]
        }
    }]
}
```

## Acessando Flags e Argumentos

Flags e argumentos estão disponíveis como variáveis de ambiente:

```cue
{
    name: "greet"
    flags: [
        {name: "loud", type: "bool", default_value: "false"}
    ]
    args: [
        {name: "name", default_value: "World"}
    ]
    implementations: [{
        script: """
            if [ "$INVOWK_FLAG_LOUD" = "true" ]; then
                echo "HELLO, $INVOWK_ARG_NAME!"
            else
                echo "Hello, $INVOWK_ARG_NAME!"
            fi
            """
        target: {
            runtimes: [{name: "native"}]
        }
    }]
}
```

```bash
invowk cmd myproject greet Alice --loud
# Saída: HELLO, ALICE!
```

## Diretório de Trabalho

Por padrão, scripts executam no diretório atual. Sobrescreva com `workdir`:

```cue
{
    name: "build frontend"
    workdir: "./frontend"  // Executar no subdiretório frontend
    implementations: [{
        script: "npm run build"
        target: {
            runtimes: [{name: "native"}]
        }
    }]
}
```

## Dependências

O runtime native valida dependências contra seu sistema host:

```cue
{
    name: "deploy"
    depends_on: {
        tools: [
            {alternatives: ["docker", "podman"]},
            {alternatives: ["kubectl"]}
        ]
        filepaths: [
            {alternatives: ["Dockerfile"]}
        ]
    }
    implementations: [{
        script: "docker build -t myapp . && kubectl apply -f k8s/"
        target: {
            runtimes: [{name: "native"}]
        }
    }]
}
```

## Vantagens

- **Performance**: Sem overhead, execução direta no shell
- **Acesso completo**: Todas as ferramentas do sistema e ambiente disponíveis
- **Familiar**: Use seu shell preferido e seus recursos
- **Interativo**: Pode executar comandos interativos

## Limitações

- **Diferenças de plataforma**: Scripts podem se comportar diferentemente entre SOs
- **Dependência de ambiente**: Depende de ferramentas instaladas
- **Reprodutibilidade**: Resultados podem variar entre máquinas

## Quando Usar Native

- **Desenvolvimento diário**: Iteração rápida, ferramentas familiares
- **Integração com sistema**: Quando você precisa de acesso a recursos do sistema
- **Tarefas interativas**: Prompts, editores, aplicações TUI
- **Performance crítica**: Quando o overhead de container importa

## Próximos Passos

- [Runtime Virtual](./virtual) - Para consistência multiplataforma
- [Runtime Container](./container) - Para builds reproduzíveis
