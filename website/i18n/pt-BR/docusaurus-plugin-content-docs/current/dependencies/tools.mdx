---
sidebar_position: 2
---

import Snippet from '@site/src/components/Snippet';

# Dependências de Ferramentas

Dependências de ferramentas verificam se os binários necessários estão disponíveis no PATH antes que seu comando seja executado.

## Uso Básico

<Snippet id="dependencies/tools-basic" />

Se `go` não for encontrado no PATH, o comando falha com um erro claro:

<Snippet id="dependencies/with-check" />

## Alternativas (Semântica OU)

Especifique múltiplas alternativas quando qualquer ferramenta funcionar:

<Snippet id="dependencies/tools-alternatives" />

O Invowk verifica as alternativas em ordem e para na primeira correspondência. Isso é útil para:
- Ferramentas com alternativas compatíveis (docker/podman)
- Preferências de editor (nvim/vim/vi)
- Variantes de versão (python3/python)

## Múltiplos Requisitos de Ferramentas

Cada entrada em `tools` é um requisito E:

```cue
depends_on: {
    tools: [
        // Precisa de (podman OU docker) E kubectl E helm
        {alternatives: ["podman", "docker"]},
        {alternatives: ["kubectl"]},
        {alternatives: ["helm"]},
    ]
}
```

Todos os três devem ser satisfeitos (embora alternativas dentro de cada um sejam OU).

## Exemplos do Mundo Real

### Projeto Go

```cue
{
    name: "build"
    depends_on: {
        tools: [
            {alternatives: ["go"]},
            {alternatives: ["git"]},  // Para informação de versão
        ]
    }
    implementations: [{
        script: """
            VERSION=$(git describe --tags --always)
            go build -ldflags="-X main.version=$VERSION" ./...
            """
        target: {runtimes: [{name: "native"}]}
    }]
}
```

### Projeto Node.js

```cue
{
    name: "build"
    depends_on: {
        tools: [
            // Prefere pnpm, mas npm também funciona
            {alternatives: ["pnpm", "npm", "yarn"]},
            {alternatives: ["node"]},
        ]
    }
    implementations: [{
        script: "pnpm run build || npm run build"
        target: {runtimes: [{name: "native"}]}
    }]
}
```

### Deploy Kubernetes

```cue
{
    name: "deploy"
    depends_on: {
        tools: [
            {alternatives: ["kubectl"]},
            {alternatives: ["helm"]},
            {alternatives: ["podman", "docker"]},
        ]
    }
    implementations: [{
        script: """
            helm upgrade --install myapp ./charts/myapp
            kubectl rollout status deployment/myapp
            """
        target: {runtimes: [{name: "native"}]}
    }]
}
```

### Projeto Python

```cue
{
    name: "run"
    depends_on: {
        tools: [
            // Python 3 com vários nomes possíveis
            {alternatives: ["python3", "python"]},
            // Ferramenta de ambiente virtual
            {alternatives: ["poetry", "pipenv", "pip"]},
        ]
    }
    implementations: [{
        script: "poetry run python main.py"
        target: {runtimes: [{name: "native"}]}
    }]
}
```

## Validação Consciente do Runtime

Verificações de ferramentas são validadas de acordo com o runtime:

### Runtime Native

Ferramentas são verificadas no sistema host:

```cue
{
    name: "build"
    depends_on: {
        tools: [{alternatives: ["go"]}]  // Verificado no host
    }
    implementations: [{
        script: "go build ./..."
        target: {runtimes: [{name: "native"}]}
    }]
}
```

### Runtime Virtual

Ferramentas são verificadas no ambiente do shell virtual:

```cue
{
    name: "build"
    depends_on: {
        tools: [{alternatives: ["go"]}]  // Verificado no shell virtual
    }
    implementations: [{
        script: "go build ./..."
        target: {runtimes: [{name: "virtual"}]}
    }]
}
```

### Runtime Container

Ferramentas são verificadas **dentro do container**:

```cue
{
    name: "build"
    implementations: [{
        script: "go build ./..."
        target: {runtimes: [{name: "container", image: "golang:1.21"}]}
        depends_on: {
            // Isso verifica 'go' DENTRO do container
            tools: [{alternatives: ["go"]}]
        }
    }]
}
```

Isso é especialmente útil porque:
- O host não precisa ter Go instalado
- Você está validando o ambiente de execução real
- Você detecta ferramentas faltando em imagens de container personalizadas

## Padrões Comuns

### Verificar Antes de Chamada Externa

```cue
{
    name: "upload"
    depends_on: {
        tools: [{alternatives: ["aws", "aws-cli"]}]
    }
    implementations: [{
        script: "aws s3 sync ./dist s3://my-bucket"
        target: {runtimes: [{name: "native"}]}
    }]
}
```

### Ferramentas de Banco de Dados

```cue
{
    name: "db migrate"
    depends_on: {
        tools: [
            {alternatives: ["psql", "pgcli"]},  // Cliente PostgreSQL
            {alternatives: ["migrate", "goose", "flyway"]},  // Ferramenta de migração
        ]
    }
    implementations: [{
        script: "migrate -path ./migrations -database $DATABASE_URL up"
        target: {runtimes: [{name: "native"}]}
    }]
}
```

### Multiplataforma

```cue
{
    name: "open docs"
    depends_on: {
        tools: [
            // Abridores específicos de plataforma
            {alternatives: ["xdg-open", "open", "start"]},
        ]
    }
    implementations: [{
        script: "xdg-open http://localhost:3000/docs || open http://localhost:3000/docs"
        target: {runtimes: [{name: "native"}]}
    }]
}
```

## Melhores Práticas

1. **Use alternativas para ferramentas compatíveis**: `{alternatives: ["podman", "docker"]}`
2. **Ordene alternativas por preferência**: A primeira alternativa é verificada primeiro
3. **Mantenha listas de ferramentas mínimas**: Requer apenas o que é realmente usado
4. **Considere o contexto do runtime**: Ferramentas de container são verificadas dentro de containers

## Próximos Passos

- [Filepaths](./filepaths) - Verificar arquivos necessários
- [Commands](./commands) - Depender de outros comandos Invowk
