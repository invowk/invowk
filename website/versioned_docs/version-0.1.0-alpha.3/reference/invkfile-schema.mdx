---
sidebar_position: 2
---

import Snippet from '@site/src/components/Snippet';

# Invkfile Schema Reference

:::warning Alpha â€” Schema May Change
The invkfile schema is still evolving. Fields, types, and validation rules **may change between releases** as we stabilize the format. Always check the [changelog](https://github.com/invowk/invowk/releases) when upgrading.
:::

Complete reference for the invkfile schema. Invkfiles use [CUE](https://cuelang.org/) format for defining commands.
Invkfiles are validated as closed structs, so unknown fields cause a validation error.

## Root Structure

Every invkfile must define at least one command in `cmds`:

<Snippet id="reference/invkfile/root-structure" />

:::note Module Metadata Lives in invkmod.cue
Fields like `module`, `version`, `description`, and `requires` belong in `invkmod.cue` and are rejected in `invkfile.cue`.
:::

### default_shell

**Type:** `string`  
**Required:** No  
**Default:** System default

Override the default shell for native runtime execution.

<Snippet id="reference/invkfile/default-shell-example" />

### workdir

**Type:** `string`  
**Required:** No  
**Default:** Invkfile directory

Default working directory for all commands. Can be absolute or relative to the invkfile location.

<Snippet id="reference/invkfile/workdir-example" />

### env

**Type:** `#EnvConfig`  
**Required:** No

Global environment configuration applied to all commands. See [EnvConfig](#envconfig).

### depends_on

**Type:** `#DependsOn`  
**Required:** No

Global dependencies that apply to all commands. See [DependsOn](#dependson).

### cmds

**Type:** `[...#Command]`  
**Required:** Yes (at least one)

List of commands defined in this invkfile. See [Command](#command).

---

## Command

Defines an executable command:

<Snippet id="reference/invkfile/command-structure" />

### name

**Type:** `string` (pattern: `^[a-zA-Z][a-zA-Z0-9_ -]*$`)  
**Required:** Yes

The command identifier. Must start with a letter.

<Snippet id="reference/invkfile/command-name-examples" />

### description

**Type:** `string`  
**Required:** No

Help text for the command.

<Snippet id="reference/invkfile/command-description-example" />

### implementations

**Type:** `[...#Implementation]`  
**Required:** Yes (at least one)

The executable implementations. See [Implementation](#implementation).

### flags

**Type:** `[...#Flag]`  
**Required:** No

Command-line flags for this command. See [Flag](#flag).

:::warning Reserved Flags
The following flags are reserved by invowk and cannot be used in user-defined commands:
- `env-file` (short `e`), `env-var` (short `E`)
- `env-inherit-mode`, `env-inherit-allow`, `env-inherit-deny`
- `workdir` (short `w`), `help` (short `h`), `runtime` (short `r`)
- `from`, `force-rebuild`, `list` (short `l`)
:::

### args

**Type:** `[...#Argument]`  
**Required:** No

Positional arguments for this command. See [Argument](#argument).

---

## Implementation

Defines how a command is executed:

<Snippet id="reference/invkfile/implementation-structure" />

### script

**Type:** `string` (non-empty)  
**Required:** Yes

The shell commands to execute OR a path to a script file.

<Snippet id="reference/invkfile/script-examples" />

**Recognized extensions:** `.sh`, `.bash`, `.ps1`, `.bat`, `.cmd`, `.py`, `.rb`, `.pl`, `.zsh`, `.fish`

### runtimes

**Type:** `[...#RuntimeConfig]`  
**Required:** Yes (at least one)

The runtimes that can execute this implementation. The first runtime is the default.

<Snippet id="reference/invkfile/runtimes-examples" />

### platforms

**Type:** `[...#PlatformConfig]`
**Required:** Yes (at least one)

Specify which operating systems this implementation supports.

<Snippet id="reference/invkfile/platforms-example" />

---

## RuntimeConfig

Configuration for a specific runtime:

<Snippet id="reference/invkfile/runtime-config-structure" />

### name

**Type:** `"native" | "virtual" | "container"`  
**Required:** Yes

The runtime type.

### interpreter

**Type:** `string`  
**Available for:** `native`, `container`  
**Default:** `"auto"` (detect from shebang)

Specifies how to execute the script.

<Snippet id="reference/invkfile/interpreter-examples" />

:::note
Virtual runtime uses mvdan/sh which cannot execute non-shell interpreters.
:::

### env_inherit_mode

**Type:** `"none" | "allow" | "all"`  
**Available for:** `native`, `virtual`, `container`  
**Default:** `all` for native/virtual, `none` for container

Controls whether the host environment is inherited by the runtime.

### env_inherit_allow

**Type:** `[...string]`  
**Available for:** `native`, `virtual`, `container`

Allowlist of host env vars when `env_inherit_mode` is `"allow"`.

### env_inherit_deny

**Type:** `[...string]`  
**Available for:** `native`, `virtual`, `container`

Denylist of host env vars (applies to any mode).

<Snippet id="reference/invkfile/env-inherit-example" />

### enable_host_ssh

**Type:** `bool`  
**Available for:** `container`  
**Default:** `false`

Enable SSH access from container back to the host. When enabled, Invowk starts an SSH server and provides credentials via environment variables:

- `INVOWK_SSH_ENABLED`
- `INVOWK_SSH_HOST`
- `INVOWK_SSH_PORT`
- `INVOWK_SSH_USER`
- `INVOWK_SSH_TOKEN`

<Snippet id="reference/invkfile/enable-host-ssh-example" />

### containerfile / image

**Type:** `string`  
**Available for:** `container`

Specify the container source. These are **mutually exclusive**.

<Snippet id="reference/invkfile/containerfile-image-examples" />

### volumes

**Type:** `[...string]`  
**Available for:** `container`

Volume mounts in `host:container[:options]` format.

<Snippet id="reference/invkfile/volumes-example" />

### ports

**Type:** `[...string]`  
**Available for:** `container`

Port mappings in `host:container` format.

<Snippet id="reference/invkfile/ports-example" />

---

## PlatformConfig

<Snippet id="reference/invkfile/platform-config-structure" />

---

## EnvConfig

Environment configuration:

<Snippet id="reference/invkfile/env-config-structure" />

### files

Dotenv files to load. Files are loaded in order; later files override earlier ones.

<Snippet id="reference/invkfile/env-files-example" />

### vars

Environment variables as key-value pairs.

<Snippet id="reference/invkfile/env-vars-example" />

---

## DependsOn

Dependency specification:

<Snippet id="reference/invkfile/depends-on-structure" />

### ToolDependency

<Snippet id="reference/invkfile/tool-dependency-structure" />

<Snippet id="reference/invkfile/tool-dependency-example" />

### CommandDependency

<Snippet id="reference/invkfile/command-dependency-structure" />

### FilepathDependency

<Snippet id="reference/invkfile/filepath-dependency-structure" />

### CapabilityDependency

<Snippet id="reference/invkfile/capability-dependency-structure" />

### EnvVarDependency

<Snippet id="reference/invkfile/env-var-dependency-structure" />

### CustomCheckDependency

<Snippet id="reference/invkfile/custom-check-dependency-structure" />

---

## Flag

Command-line flag definition:

<Snippet id="reference/invkfile/flag-structure" />

<Snippet id="reference/invkfile/flag-example" />

---

## Argument

Positional argument definition:

<Snippet id="reference/invkfile/argument-structure" />

<Snippet id="reference/invkfile/argument-example" />

**Environment Variables for Arguments:**
- `INVOWK_ARG_<NAME>` - The argument value
- For variadic: `INVOWK_ARG_<NAME>_COUNT`, `INVOWK_ARG_<NAME>_1`, `INVOWK_ARG_<NAME>_2`, etc.

---

## Complete Example

<Snippet id="reference/invkfile/complete-example" />
