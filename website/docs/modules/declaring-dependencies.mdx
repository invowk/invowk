---
sidebar_position: 2
---

# Declaring Dependencies

Module dependencies are declared in the `requires` field of your invkfile. This page covers the syntax and options available.

## Basic Syntax

```cue
group: "myproject"
version: "1.0"

requires: [
	{
		git_url: "https://github.com/user/pack.git"
		version: "^1.0.0"
	},
]

cmds: [
	// Your commands here
]
```

## Requirement Fields

| Field | Required | Description |
|-------|----------|-------------|
| `git_url` | Yes | Git repository URL (HTTPS or SSH) |
| `version` | Yes | Semantic version constraint |
| `alias` | No | Custom namespace for commands |
| `path` | No | Subdirectory within the repository |

### git_url

The Git repository URL. Supports both HTTPS and SSH formats:

```cue
requires: [
	// HTTPS (works with public repos or GITHUB_TOKEN)
	{git_url: "https://github.com/user/pack.git", version: "^1.0.0"},

	// SSH (requires SSH key in ~/.ssh/)
	{git_url: "git@github.com:user/pack.git", version: "^1.0.0"},

	// GitLab
	{git_url: "https://gitlab.com/user/pack.git", version: "^1.0.0"},

	// Self-hosted
	{git_url: "https://git.example.com/user/pack.git", version: "^1.0.0"},
]
```

### version

Semantic version constraint. The repository must have Git tags matching the constraint.

#### Version Constraint Formats

| Format | Description | Matches |
|--------|-------------|---------|
| `^1.2.3` | Compatible (same major) | `>=1.2.3 <2.0.0` |
| `~1.2.3` | Approximately (same minor) | `>=1.2.3 <1.3.0` |
| `>=1.0.0` | Greater than or equal | `1.0.0`, `1.5.0`, `2.0.0`, ... |
| `>1.0.0` | Greater than | `1.0.1`, `1.5.0`, `2.0.0`, ... |
| `<2.0.0` | Less than | `1.9.9`, `1.0.0`, `0.5.0`, ... |
| `<=2.0.0` | Less than or equal | `2.0.0`, `1.9.9`, `1.0.0`, ... |
| `1.2.3` | Exact version | Only `1.2.3` |

#### Version Tag Formats

Invowk accepts tags with or without the `v` prefix:

- `v1.2.3` and `1.2.3` are both valid
- When resolving, both formats are tried automatically

```cue
requires: [
	// Both work - invowk tries v1.0.0 and 1.0.0
	{git_url: "https://github.com/user/pack.git", version: "^1.0.0"},
]
```

### alias

Override the default namespace for the module's commands:

```cue
requires: [
	// Default namespace: common-tools@1.2.3
	{git_url: "https://github.com/user/common-tools.git", version: "^1.0.0"},

	// Custom namespace: tools
	{
		git_url: "https://github.com/user/common-tools.git"
		version: "^1.0.0"
		alias:   "tools"
	},
]
```

Usage with alias:

```bash
# Instead of: invowk cmd common-tools@1.2.3 build
invowk cmd tools build
```

### path

For monorepos containing multiple packs, specify the subdirectory:

```cue
requires: [
	{
		git_url: "https://github.com/user/monorepo.git"
		version: "^1.0.0"
		path:    "packages/cli-tools"
	},
	{
		git_url: "https://github.com/user/monorepo.git"
		version: "^1.0.0"
		path:    "packages/deploy-utils"
		alias:   "deploy"
	},
]
```

## Multiple Dependencies

Declare multiple modules in the `requires` array:

```cue
requires: [
	{
		git_url: "https://github.com/company/build-tools.git"
		version: "^2.0.0"
		alias:   "build"
	},
	{
		git_url: "https://github.com/company/deploy-tools.git"
		version: "~1.5.0"
		alias:   "deploy"
	},
	{
		git_url: "https://github.com/company/test-utils.git"
		version: ">=1.0.0 <2.0.0"
	},
]
```

## Authentication

### SSH Keys

For SSH URLs (`git@...`), invowk uses keys from `~/.ssh/`:

1. `~/.ssh/id_ed25519` (preferred)
2. `~/.ssh/id_rsa`
3. `~/.ssh/id_ecdsa`

### HTTPS Tokens

For private HTTPS repositories, set environment variables:

```bash
# GitHub
export GITHUB_TOKEN=ghp_xxxx

# GitLab
export GITLAB_TOKEN=glpat-xxxx

# Generic (any Git server)
export GIT_TOKEN=your-token
```

## Transitive Dependencies

Modules can declare their own dependencies. When you sync, invowk resolves the entire dependency tree:

```
myproject
├── common-tools@1.2.3
│   └── logging-utils@2.0.0
└── deploy-utils@1.5.0
    └── common-tools@1.2.3  (shared)
```

### Circular Dependency Detection

Invowk detects and reports circular dependencies:

```
Error: circular dependency detected: github.com/user/pack-a -> github.com/user/pack-b -> github.com/user/pack-a
```

## Best Practices

### 1. Use Caret for Most Dependencies

```cue
// Good: allows patch and minor updates
{git_url: "...", version: "^1.0.0"}

// Too strict: no updates allowed
{git_url: "...", version: "1.0.0"}
```

### 2. Use Aliases for Cleaner Commands

```cue
// Without alias: invowk cmd company-internal-build-tools@2.3.1 compile
// With alias: invowk cmd build compile
{
	git_url: "https://github.com/company/company-internal-build-tools.git"
	version: "^2.0.0"
	alias:   "build"
}
```

### 3. Commit Your Lock File

The `invowk.lock.cue` file should be committed to version control for reproducible builds.

### 4. Update Regularly

```bash
# Update all modules to latest matching versions
invowk module update
```

## Schema Reference

```cue
#ModuleRequirement: {
	// Git repository URL (required)
	// Must start with https://, git@, or ssh://
	git_url: string & =~"^(https://|git@|ssh://)"

	// Semantic version constraint (required)
	// Supports ^, ~, >, >=, <, <=, and exact versions
	version: string & =~"^[~^>=<]?[0-9]+"

	// Custom namespace alias (optional)
	// Must be a valid identifier
	alias?: string & =~"^[a-zA-Z][a-zA-Z0-9]*(\\.[a-zA-Z][a-zA-Z0-9]*)*$"

	// Subdirectory path within repository (optional)
	// For monorepos with multiple packs
	path?: string
}
```
