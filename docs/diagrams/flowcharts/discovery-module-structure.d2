# Module Structure Flowchart
#
# Shows the directory structure and required files
# for an Invowk module (.invowkmod directory).
#
# Source: docs/architecture/flowchart-discovery.md

vars: {
  d2-config: {
    layout-engine: tala
  }
}

direction: down

# ==============================================================================
# Entry Point
# ==============================================================================

Start: Start module inspection {
  shape: oval
  style.fill: "#E8F5E9"
}

# ==============================================================================
# Module Structure
# ==============================================================================

module_structure: Module Structure {
  style: {
    stroke: "#1168BD"
    stroke-dash: 3
    fill: transparent
  }

  ModDir: "*.invowkmod/" {
    style.fill: "#BBDEFB"
  }

  InvowkmodCue: invowkmod.cue\n(metadata) {
    style.fill: "#C8E6C9"
  }

  InvowkfileCue: invowkfile.cue\n(commands) {
    style.fill: "#C8E6C9"
  }

  Scripts: scripts/\n(optional) {
    style.fill: "#E8E8E8"
  }

  Files: other files\n(optional) {
    style.fill: "#E8E8E8"
  }

  ModDir -> InvowkmodCue
  ModDir -> InvowkfileCue
  ModDir -> Scripts
  ModDir -> Files
}

# ==============================================================================
# Module Metadata
# ==============================================================================

module_metadata: Module Metadata (invowkmod.cue) {
  style: {
    stroke: "#1168BD"
    stroke-dash: 3
    fill: transparent
  }

  Meta: |md
    ```
    module: 'com.example.mymod'
    version: '1.0.0'
    requires: [...]
    ```
  | {
    style.fill: "#FFF3E0"
  }
}

module_structure.InvowkmodCue -> module_metadata.Meta
Start -> module_structure.ModDir
