# Discovery Conflict Resolution Flowchart
#
# Shows how Invowk resolves conflicts when the same command
# name exists in multiple discovery locations.
# Key principle:
# - Same full-name command: first discovered source wins
# - Same simple-name command across sources: mark ambiguous and require disambiguation
#
# Source: docs/architecture/flowchart-discovery.md

vars: {
  d2-config: {
    layout-engine: tala
  }
}

direction: down

# ==============================================================================
# Entry Point
# ==============================================================================

Start: Start conflict resolution {
  shape: oval
  style.fill: "#E8F5E9"
}

# ==============================================================================
# Command Found in Multiple Locations
# ==============================================================================

locations: Command 'build' found in multiple locations {
  style: {
    stroke: "#1168BD"
    stroke-dash: 3
    fill: transparent
  }

  L1: ./invowkfile.cue\nPriority: 1 (highest) {
    style.fill: "#90EE90"
  }

  L2: ./mytools.invowkmod\nPriority: 2 {
    style.fill: "#FFE4B5"
  }

  L3: Configured includes\nPriority: 3 {
    style.fill: "#FFE4B5"
  }

  L4: ~/.invowk/cmds/\nPriority: 4 (lowest) {
    style.fill: "#FFE4B5"
  }
}

# ==============================================================================
# Resolution
# ==============================================================================

Conflict: Name collision detected {
  shape: diamond
  style.fill: "#FFF3E0"
}

FirstWins: Same full command name:\nfirst discovered source wins {
  style.fill: "#C8E6C9"
}

Ambiguous: Same simple name across\nmultiple sources:\nmark as ambiguous {
  style.fill: "#FFE4B5"
}

Disambiguate: User must disambiguate\nwith @source or --ivk-from {
  style.fill: "#BBDEFB"
}

Start -> Conflict
Conflict -> FirstWins: same full name
Conflict -> Ambiguous: same simple name,\ndifferent source
FirstWins -> locations.L1
Ambiguous -> Disambiguate
