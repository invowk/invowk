# Container Runtime Availability Check Flowchart
#
# Shows how Invowk detects container engine availability,
# checking preferred engine first then falling back.
# Both directions are symmetric: Docker falls back to Podman
# and Podman falls back to Docker.
#
# Source: internal/container/engine.go (NewEngine, AutoDetectEngine)

vars: {
  d2-config: {
    layout-engine: tala
  }
}

direction: down

Start: Check Container {
  shape: oval
  style.fill: "#E8F5E9"
}

Pref: Preferred engine\nin config? {
  shape: diamond
  style.fill: "#FFF3E0"
}

TryDocker: Try Docker
TryPodman: Try Podman

DockerOK: Docker available? {
  shape: diamond
  style.fill: "#FFF3E0"
}

PodmanOK: Podman available? {
  shape: diamond
  style.fill: "#FFF3E0"
}

# Fallback check nodes (when preferred engine unavailable)
FallbackPodman: Podman available? {
  shape: diamond
  style.fill: "#FFF3E0"
}

FallbackDocker: Docker available? {
  shape: diamond
  style.fill: "#FFF3E0"
}

UseDocker: Use Docker {
  shape: oval
  style.fill: "#C8E6C9"
}

UsePodman: Use Podman {
  shape: oval
  style.fill: "#C8E6C9"
}

Unavailable: No Engine Available {
  shape: oval
  style.fill: "#FFCDD2"
}

Start -> Pref
Pref -> TryDocker: docker
Pref -> TryPodman: podman
Pref -> TryPodman: not set

# Docker-preferred path
TryDocker -> DockerOK
DockerOK -> UseDocker: Yes
DockerOK -> FallbackPodman: No

# Docker fallback to Podman
FallbackPodman -> UsePodman: Yes
FallbackPodman -> Unavailable: No

# Podman-preferred path (also used for "not set" / auto-detect)
TryPodman -> PodmanOK
PodmanOK -> UsePodman: Yes
PodmanOK -> FallbackDocker: No

# Podman fallback to Docker
FallbackDocker -> UseDocker: Yes
FallbackDocker -> Unavailable: No
