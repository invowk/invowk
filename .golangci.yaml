version: "2"
run:
  modules-download-mode: readonly
  tests: true
  go: ""
output:
  # No, no skips, everything should be reported.
  uniq-by-line: false
linters:
  fast: false
  default: none
  enable:
    # Check for pass []any as any in variadic func(...any).
    # Rare case but saved me from debugging a few times.
    - asasalint
    # I prefer plane ASCII identifiers.
    # Symbol `âˆ†` instead of `delta` looks cool but no thanks.
    - asciicheck
    # Checks for dangerous unicode character sequences.
    # Super rare but why not to be a bit paranoid?
    - bidichk
    # Check for two durations multiplied together.
    - durationcheck
    # Checks `Err-` prefix for var and `-Error` suffix for error type.
    - errname
    # Checks for pointers to enclosing loop variables.
    - exportloopref
    # Might not be that important but I prefer to keep all of them.
    # `gofumpt` is amazing, kudos to Daniel Marti https://github.com/mvdan/gofumpt
    - gofmt
    - gofumpt
    - goimports
    # Linter that specializes in simplifying code.
    - gosimple
    # Both require a bit more explicit returns.
    - nilerr
    - nilnil
    # Finds sending HTTP request without context.Context.
    - noctx
    # Finds shadowing of Go's predeclared identifiers.
    # I hear a lot of complaints from junior developers.
    # But after some time they find it very useful.
    - predeclared
    # Checks that package variables are not reassigned.
    # Super rare case but can catch bad things (like `io.EOF = nil`)
    - reassign
    # Is a replacement for `golint`, similar to `revive`.
    - stylecheck
    # Check struct tags.
    - tagliatelle
    # Test-related checks. All of them are good.
    - tenv
    - testableexamples
    - thelper
    - tparallel
    # Remove unnecessary type conversions, make code cleaner
    - unconvert
    # Must have. Finds unused declarations.
    - unused
    # Detect the possibility to use variables/constants from stdlib.
    - usestdlibvars
    # Finds wasted assignment statements.
    - wastedassign
    - gocritic
    - bodyclose
    - errcheck
    - errorlint
    - exhaustive
    - gocritic
    - gosec
    - govet
    - ineffassign
    - nakedret
    - revive
    - staticcheck
    - unused
    - wrapcheck
  settings:
    gocritic:
      enabled-tags:
        - diagnostic
        - style
        - performance
      disabled-checks:
        - hugeParam # TUI options are intentionally passed by value
    errcheck:
      # Report `a := b.(MyStruct)` when `a, ok := ...` should be.
      check-type-assertions: true # Default: false

      # Report skipped checks:`num, _ := strconv.Atoi(numStr)`.
      check-blank: true # Default: false

      # Function to skip.
      exclude-functions:
        - io/ioutil.ReadFile
        - io.Copy(*bytes.Buffer)
        - io.Copy(os.Stdout)
    gosec:
      excludes:
        - G104 # Unhandled errors - covered by errcheck linter
        - G115 # Integer overflow - many false positives in Go
        - G204 # Subprocess with variable - command runner by design
        - G301 # Dir perms > 0750 - directories need 0755 for traversability
        - G302 # File created with excessive perms - config files need world-readable
        - G304 # File inclusion via variable - must read user config/invkfiles
        - G306 # WriteFile perms > 0600 - config/module files need 0644 for readability
      config:
        global:
          tests: false
    govet:
      enable:
        - shadow
    nakedret:
      max-func-lines: 10
    revive:
      rules:
        - name: exported
          severity: warning
    wrapcheck:
      ignore-sigs:
        - .Errorf(
        - errors.New(
        - errors.Unwrap(
        - .Join(
        # Standard library signatures - context usually clear from call site
        - .Close()
        - .Read(
        - .Write(
        - .WriteString(
        - .Run()
        - .Start()
        - .Wait()
        - .Open()
        - .Info()
        - .Shutdown(
        - .CombinedOutput()
        - io.Copy(
        - io.ReadAll(
        - os.MkdirAll(
        - os.Open(
        - os.OpenFile(
        - os.Create(
        - os.CreateTemp(
        - os.ReadFile(
        - os.ReadDir(
        - os.WriteFile(
        - os.Stat(
        - filepath.Walk(
        - exec.LookPath(
        - json.Unmarshal(
        - json.Marshal(
      ignore-package-globs:
        - invowk-cli/*  # Internal module packages - wrapped at public API boundaries
        - github.com/charmbracelet/*  # TUI library - errors self-descriptive
        - github.com/go-git/*  # Git library - errors already descriptive
        - github.com/creack/pty  # PTY library - used in context
        - golang.org/x/sys/*  # Syscall wrappers - low-level
  exclusions:
    generated: lax
    paths:
      - third_party$
      - builtin$
      - examples$
issues:
  max-issues-per-linter: 0
  max-same-issues: 0
formatters:
  exclusions:
    generated: lax
    paths:
      - third_party$
      - builtin$
      - examples$
