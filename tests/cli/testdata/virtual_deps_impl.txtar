# Test: Implementation-level depends_on
# Tests that depends_on at the implementation level is checked

cd $WORK

# Test 1: Implementation-level tool dep satisfied
exec invowk cmd 'impl deps satisfied'
stdout 'implementation deps passed'
! stderr .

# Test 2: Implementation-level tool dep unsatisfied
! exec invowk cmd 'impl deps missing'
stderr '(?i)dependencies not satisfied'
stderr 'Missing Tools'
stderr 'nonexistent-impl-tool-xyz'

-- invowkfile.cue --
cmds: [
	{
		name: "impl deps satisfied"
		implementations: [{
			script:    "echo 'implementation deps passed'"
			runtimes:  [{name: "virtual"}]
			platforms: [{name: "linux"}, {name: "macos"}, {name: "windows"}]
			depends_on: {
				tools: [{alternatives: ["sh"]}]
			}
		}]
	},
	{
		name: "impl deps missing"
		implementations: [{
			script:    "echo 'should not run'"
			runtimes:  [{name: "virtual"}]
			platforms: [{name: "linux"}, {name: "macos"}, {name: "windows"}]
			depends_on: {
				tools: [{alternatives: ["nonexistent-impl-tool-xyz"]}]
			}
		}]
	},
]
