# Test: Positional argument handling (09-args.tape equivalent)
# Tests args: simple, optional, typed, validated

# Run against project's invkfile.cue
cd $PROJECT_ROOT

# Test 1: args simple - with required argument (should work)
exec invowk cmd 'args simple' Alice
stdout '=== Simple Positional Argument Demo ==='
stdout 'INVOWK_ARG_NAME.*Alice'
stdout 'Hello, Alice!'
! stderr .

# Test 2: args simple - missing required argument (should fail)
! exec invowk cmd 'args simple'
stderr 'Missing required arguments'
stderr 'args simple'
stderr 'name'
stderr 'required'

# Test 3: args optional - with only required argument
exec invowk cmd 'args optional' Bob
stdout '=== Required \+ Optional Arguments Demo ==='
stdout 'INVOWK_ARG_NAME.*Bob'
stdout 'INVOWK_ARG_GREETING.*Hello'
! stderr .

# Test 4: args optional - with both required and optional arguments
exec invowk cmd 'args optional' Charlie Howdy
stdout 'INVOWK_ARG_NAME.*Charlie'
stdout 'INVOWK_ARG_GREETING.*Howdy'
! stderr .

# Test 5: args typed - with valid typed arguments (int, int, float)
exec invowk cmd 'args typed' 800 600 1.5
stdout '=== Typed Arguments Demo ==='
stdout 'INVOWK_ARG_WIDTH.*800'
stdout 'INVOWK_ARG_HEIGHT.*600'
stdout 'INVOWK_ARG_SCALE.*1.5'
! stderr .

# Test 6: args typed - with invalid type (should fail)
! exec invowk cmd 'args typed' not-a-number 600 1.5
stderr 'Invalid argument value'
stderr 'width'

# Test 7: args validated - with valid values matching regex patterns
# Note: version must be semver format X.Y.Z (no 'v' prefix)
exec invowk cmd 'args validated' prod 1.2.3
stdout '=== Validated Arguments Demo ==='
stdout 'INVOWK_ARG_ENV.*prod'
stdout 'INVOWK_ARG_VERSION.*1.2.3'
! stderr .

# Test 8: args validated - with invalid env value (should fail)
! exec invowk cmd 'args validated' invalid-env 1.0.0
stderr 'Invalid argument value'
stderr 'env'

# Test 9: args validated - with invalid version format (should fail)
# 'v1.0.0' is invalid because the pattern requires X.Y.Z without the 'v' prefix
! exec invowk cmd 'args validated' dev v1.0.0
stderr 'Invalid argument value'
stderr 'version'
